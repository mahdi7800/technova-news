<?phpadd_action( 'wp_ajax_nopriv_tnw_register_form', 'tnw_register_form' );function tnw_register_form() {	if ( ! isset( $_POST['nonce'] ) && ! wp_verify_nonce( $_POST['nonce'] ) ) {		die( 'access deind' );	}	$full_name = sanitize_text_field( $_POST['full_name'] );	$email     = sanitize_text_field( $_POST['email'] );	$password  = sanitize_text_field( $_POST['password'] );	$phone_number = $_POST['phone_number'];	$display_name_parts = explode( ' ', $full_name );	$first_name   = $display_name_parts[0] ?? '';	$last_name    = $display_name_parts[1] ?? '';	$display_name = trim( $first_name . ' ' . $last_name );	tnw_register_form_validate( $full_name, $email, $password );	$userdata       = [		'user_login'   => apply_filters('pre_user_login', explode( '@', $email )[0] . rand( 1, 99 )),		'display_name' => apply_filters('pre_user_display_name', $display_name),		'first_name'   => apply_filters('pre_user_first_name', $first_name ),		'last_name'    => apply_filters('pre_user_last_name', $last_name),		'user_email'   => apply_filters('pre_user_email', $email),		'user_pass'    => apply_filters('pre_user_pass', $password),	];	$insert_user_id = wp_insert_user( $userdata );	if ( ! is_wp_error( $insert_user_id ) ) {		add_user_meta($insert_user_id,'_tnw_user_phone_number',$phone_number);			wp_send_json( [				'success'      => true,				'message'      => 'ثبت نام شما با موفقیت انجام شد',				'redirect_url' => site_url()], 200			);		$bodyId =get_option( '_tnw_sms_website')['sms_data']['welcome'];		    tnw_send_sms($display_name,$phone_number,$bodyId);	} else {		wp_send_json(['error' => true, 'message' => 'خطایی در ثبت نام لطفا دوباره تلاش کنید!'], 403);	}}// Validatefunction tnw_register_form_validate( $full_name, $email, $password ) {	if ( empty( $full_name ) && empty( $email ) && empty( $password ) ) {		wp_send_json( [ 'error' => true, 'message' => 'پر کردن تمام فیلد ها الزامی است!' ], 403 );	}	if ( empty( $email ) ) {		wp_send_json( [ 'error' => true, 'message' => 'لطفا ایمیل خود را وارد کنید!' ], 403 );	} elseif ( ! is_email( $email ) ) {		wp_send_json( [ 'error' => true, 'message' => 'لطفا ایمیل معتبر  وارد کنید!' ], 403 );	} elseif ( email_exists( $email ) ) {		wp_send_json( [ 'error' => true, 'message' => 'شما قبلا با این ایمیل ثبت نام کرده اید!' ], 403 );	}	if ( empty( $password ) ) {		wp_send_json( [ 'error' => true, 'message' => 'لطفا رمز عبور خود را وارد کنید!' ], 403 );	} elseif ( ! preg_match( '/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/', $password ) ) {		wp_send_json( [			'error'   => true,			'message' => 'پسورد شما باید شامل حداقل 8 کارکتر و یک حرف بزرگ یک کارکتر ویژه باید باشد!'		], 403 );	}	if ( empty( $full_name ) ) {		wp_send_json( [ 'error' => true, 'message' => 'لطفا نام و نام خانوادگی  خود را وارد کنید!' ], 403 );	} elseif ( ! substr_count( $full_name, ' ' ) ) {		wp_send_json( [ 'error' => true, 'message' => 'بیین نام و نام خانوادگی  یک فاصله قرار دهید' ], 403 );	}}